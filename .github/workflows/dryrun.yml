name: Dry Run Sync Anime 1080p Custom Formats

on:
  workflow_dispatch:

jobs:
  dry_run_custom_formats:
    runs-on: ubuntu-latest
    steps:
      - name: Install dependencies
        run: sudo apt-get update && sudo apt-get install -y yq curl git

      - name: Download latest anime 1080p.yml
        run: |
          curl -fsSL "https://raw.githubusercontent.com/sweatyeggs69/profilarr/stable/profiles/Anime%201080p.yml" -o anime_1080p.yml

      - name: Parse custom formats from anime 1080p.yml
        id: parse_formats
        run: |
          FORMATS=($(yq e '.custom_formats[].name' anime_1080p.yml))
          echo "Custom formats found in anime 1080p.yml:"
          printf "  - %s\n" "${FORMATS[@]}"
          echo "formats=${FORMATS[*]}" >> $GITHUB_OUTPUT

      - name: Dry run download of required custom formats
        run: |
          BASE_URL="https://raw.githubusercontent.com/sweatyeggs69/profilarr/stable/custom_formats"
          echo "Dry run: The following custom formats would be downloaded/updated:"
          for f in ${{ steps.parse_formats.outputs.formats }}; do
            FILE_NAME="$f.yml"
            URL="$BASE_URL/$(echo $FILE_NAME | sed 's/ /%20/g')"
            echo "  - $FILE_NAME from $URL"
          done

      - name: Dry run extraction of regex patterns
        run: |
          echo "Dry run: The following regex patterns would be extracted:"
          for f in ${{ steps.parse_formats.outputs.formats }}; do
            FILE_NAME="$f.yml"
            echo "  - Patterns from $FILE_NAME (example output):"
            echo "      * [parsed from YAML using yq]"
          done

      - name: Dry run summary of changes
        run: |
          echo "Dry run complete. No files were overwritten or committed."
          echo "Summary:"
          echo "  - anime 1080p.yml would be updated"
          echo "  - The above custom_formats would be updated/added"
          echo "  - regex_patterns.txt would be regenerated"
